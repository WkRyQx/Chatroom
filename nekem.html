<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poolchat</title>
    <link rel="stylesheet" href="index.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Bejelentkez√©s/Regisztr√°ci√≥ k√©perny≈ë -->
    <div id="auth-screen" class="screen active">
        <div class="auth-container">
            <h1 class="logo">Poolchat</h1>
            
            <div class="auth-tabs">
                <button class="tab-btn active" onclick="showLogin()">Bejelentkez√©s</button>
                <button class="tab-btn" onclick="showRegister()">Regisztr√°ci√≥</button>
            </div>

            <!-- Bejelentkez√©s form -->
            <form id="login-form" class="auth-form active">
                <div class="form-group">
                    <label>Felhaszn√°l√≥n√©v</label>
                    <input type="text" id="login-username" required>
                </div>
                <div class="form-group">
                    <label>Jelsz√≥</label>
                    <input type="password" id="login-password" required>
                </div>
                <div class="form-group">
                    <label>Iskola</label>
                    <select id="login-school" required>
                        <option value="">V√°lassz iskol√°t</option>
                        <option value="boros">Boros S√°muel Technikum</option>
                        <option value="pollak">Poll√°k Antal Technikum</option>
                        <option value="zsoldos">Zsoldos Ferenc Technikum</option>
                        <option value="horvath">Horv√°th Mih√°ly Gimn√°zium</option>
                    </select>
                </div>
                <button type="submit" class="auth-btn">Bejelentkez√©s</button>
            </form>

            <!-- Regisztr√°ci√≥ form -->
            <form id="register-form" class="auth-form">
                <div class="form-group">
                    <label>Felhaszn√°l√≥n√©v</label>
                    <input type="text" id="reg-username" required>
                </div>
                <div class="form-group">
                    <label>Jelsz√≥</label>
                    <input type="password" id="reg-password" required>
                </div>
                <div class="form-group">
                    <label>Iskola neve</label>
                    <select id="reg-school" required>
                        <option value="">V√°lassz iskol√°t</option>
                        <option value="boros">Boros S√°muel Technikum</option>
                        <option value="pollak">Poll√°k Antal Technikum</option>
                        <option value="zsoldos">Zsoldos Ferenc Technikum</option>
                        <option value="horvath">Horv√°th Mih√°ly Gimn√°zium</option>
                        <option value="szte">SZTE</option>
                        <option value="kefo">KEF≈ê</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Kor</label>
                    <input type="number" id="reg-age" min="14" max="30" required>
                </div>
                <div class="form-group">
                    <label>Nem</label>
                    <select id="reg-gender" required>
                        <option value="">V√°lassz nemet</option>
                        <option value="ferfi">F√©rfi</option>
                        <option value="no">N≈ë</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>OM azonos√≠t√≥</label>
                    <input type="text" id="reg-om" required>
                </div>
                <button type="submit" class="auth-btn">Regisztr√°ci√≥</button>
            </form>
        </div>
    </div>

    <!-- F≈ëk√©perny≈ë -->
    <div id="main-screen" class="screen">
        <!-- Be√°ll√≠t√°sok gomb -->
        <button id="settings-btn" class="settings-btn">
            <i class="fas fa-cog"></i>
        </button>

        <!-- Be√°ll√≠t√°sok panel -->
        <div id="settings-panel" class="settings-panel">
            <div class="settings-header">
                <h3>Be√°ll√≠t√°sok</h3>
                <button id="close-settings" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="settings-content">
                <!-- Adatlap -->
                <div class="settings-section">
                    <h4>Adatlap</h4>
                    <div class="user-info">
                        <p><strong>Iskola:</strong> <span id="user-school"></span></p>
                        <p><strong>Kor:</strong> <span id="user-age"></span></p>
                        <p><strong>Nem:</strong> <span id="user-gender"></span></p>
                    </div>
                    <div class="activity-info">
                        <p><strong>Aktivit√°s:</strong></p>
                        <p>Posztolt √∂tletek: <span id="user-posts">0</span></p>
                        <p>Likeok: <span id="user-likes">0</span></p>
                    </div>
                </div>

                <!-- Megjelen√≠t√©s -->
                <div class="settings-section">
                    <h4>Megjelen√≠t√©s</h4>
                    <div class="theme-toggle">
                        <button id="light-mode" class="theme-btn active">
                            <i class="fas fa-sun"></i> Light Mode
                        </button>
                        <button id="dark-mode" class="theme-btn">
                            <i class="fas fa-moon"></i> Dark Mode
                        </button>
                    </div>
                </div>

                <!-- √ârtes√≠t√©sek -->
                <div class="settings-section">
                    <h4>√ârtes√≠t√©sek</h4>
                    <div class="notification-settings">
                        <label class="switch">
                            <input type="checkbox" id="chat-notifications" checked>
                            <span class="slider"></span>
                            Chat √©rtes√≠t√©sek
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="post-notifications" checked>
                            <span class="slider"></span>
                            √öj bejegyz√©sek
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- F≈ëmen√º gombok -->
        <div class="main-menu">
            <button class="menu-btn" onclick="showSection('innovations')">
                <i class="fas fa-lightbulb"></i>
                <span>√öj√≠t√°sok</span>
            </button>
            <button class="menu-btn" onclick="showSection('chat')">
                <i class="fas fa-comments"></i>
                <span>Chat</span>
            </button>
            <button class="menu-btn" onclick="showSection('profile')">
                <i class="fas fa-user"></i>
                <span>Profil</span>
            </button>
        </div>
    </div>

    <!-- √öj√≠t√°sok szekci√≥ -->
    <div id="innovations-screen" class="screen">
        <div class="section-header">
            <button class="back-btn" onclick="showMainMenu()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h2>√öj√≠t√°sok</h2>
        </div>
        
        <div class="innovations-container">
            <div class="add-post">
                <textarea id="new-post" placeholder="Oszd meg az √∂tleted..."></textarea>
                <button onclick="addPost()">K√∂zz√©t√©tel</button>
            </div>
            
            <div id="posts-container" class="posts-container">
                <!-- P√©lda bejegyz√©sek -->
                <div class="post">
                    <div class="post-header">
                        <strong>Anonymous</strong>
                        <span class="post-time">2 √≥r√°ja</span>
                    </div>
                    <div class="post-content">
                        √öj tanul√°si m√≥dszer: gamifik√°lt programoz√°s oktat√°s VR k√∂rnyezetben!
                    </div>
                    <div class="post-actions">
                        <button class="like-btn" onclick="toggleLike(this)">
                            <i class="far fa-heart"></i>
                            <span class="like-count">5</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat szekci√≥ -->
    <div id="chat-screen" class="screen">
        <div class="section-header">
            <button class="back-btn" onclick="showMainMenu()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h2>Chat</h2>
        </div>
        
        <div class="chat-container">
            <button id="start-chat-btn" class="start-chat-btn" onclick="startChat()">
                <span class="btn-text">√öj besz√©lget√©s ind√≠t√°sa</span>
                <div class="loading-spinner" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
            </button>
            
            <div id="chat-window" class="chat-window" style="display: none;">
                <div class="chat-header">
                    <div class="partner-info">
                        <strong id="partner-name">Partner</strong>
                        <div class="partner-details">
                            <span id="partner-school"></span> ‚Ä¢ 
                            <span id="partner-age"></span> √©ves ‚Ä¢ 
                            <span id="partner-gender"></span>
                        </div>
                    </div>
                    <button class="end-chat-btn" onclick="endChat()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div id="messages-container" class="messages-container">
                </div>
                
                <div class="message-input">
                    <input type="text" id="message-input" placeholder="√çrj √ºzenetet...">
                    <button onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profil szekci√≥ -->
    <div id="profile-screen" class="screen">
        <div class="section-header">
            <button class="back-btn" onclick="showMainMenu()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h2>Profil</h2>
        </div>
        
        <div class="profile-container">
            <div class="profile-info">
                <div class="profile-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <h3 id="profile-username"></h3>
                <p id="profile-school-info"></p>
            </div>
            
            <div class="profile-stats">
                <div class="stat">
                    <span class="stat-number" id="profile-posts">0</span>
                    <span class="stat-label">Bejegyz√©s</span>
                </div>
                <div class="stat">
                    <span class="stat-number" id="profile-likes">0</span>
                    <span class="stat-label">Like</span>
                </div>
            </div>
            
            <button class="logout-btn" onclick="logout()">Kijelentkez√©s</button>
        </div>
    </div>

    <script src="main.js">let currentUser = null;
let currentTheme = 'light';
let posts = [];
let userStats = {
    posts: 0,
    likes: 0
};
let chatPartner = null;
let chatMessages = [];

// Iskola nevek mapping
const schoolNames = {
    'boros': 'Boros S√°muel Technikum',
    'pollak': 'Poll√°k Antal Technikum',
    'zsoldos': 'Zsoldos Ferenc Technikum',
    'horvath': 'Horv√°th Mih√°ly Gimn√°zium',
    'szte': 'SZTE',
    'kefo': 'KEF≈ê'
};

// Nem mapping
const genderNames = {
    'ferfi': 'F√©rfi',
    'no': 'N≈ë'
};

// Inicializ√°l√°s
document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
    setupEventListeners();
});

function initializeApp() {
    // Ellen≈ërizz√ºk, hogy be van-e jelentkezve a felhaszn√°l√≥
    const savedUser = localStorage.getItem('poolchat_user');
    if (savedUser) {
        currentUser = JSON.parse(savedUser);
        showMainMenu();
        updateUserInterface();
    }
    
    // T√©ma bet√∂lt√©se
    const savedTheme = localStorage.getItem('poolchat_theme') || 'light';
    setTheme(savedTheme);
    
    // Statisztik√°k bet√∂lt√©se
    const savedStats = localStorage.getItem('poolchat_stats');
    if (savedStats) {
        userStats = JSON.parse(savedStats);
    }
    
    // Bejegyz√©sek bet√∂lt√©se
    const savedPosts = localStorage.getItem('poolchat_posts');
    if (savedPosts) {
        posts = JSON.parse(savedPosts);
        renderPosts();
    }
}

function setupEventListeners() {
    // Auth form listeners
    document.getElementById('login-form').addEventListener('submit', handleLogin);
    document.getElementById('register-form').addEventListener('submit', handleRegister);
    
    // Settings listeners
    document.getElementById('settings-btn').addEventListener('click', toggleSettings);
    document.getElementById('close-settings').addEventListener('click', closeSettings);
    document.getElementById('light-mode').addEventListener('click', () => setTheme('light'));
    document.getElementById('dark-mode').addEventListener('click', () => setTheme('dark'));
    
    // Chat input listener
    document.getElementById('message-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });
}

// Auth functions
function showLogin() {
    document.querySelector('.tab-btn.active').classList.remove('active');
    document.querySelector('.auth-form.active').classList.remove('active');
    
    document.querySelectorAll('.tab-btn')[0].classList.add('active');
    document.getElementById('login-form').classList.add('active');
}

function showRegister() {
    document.querySelector('.tab-btn.active').classList.remove('active');
    document.querySelector('.auth-form.active').classList.remove('active');
    
    document.querySelectorAll('.tab-btn')[1].classList.add('active');
    document.getElementById('register-form').classList.add('active');
}

function handleLogin(e) {
    e.preventDefault();
    
    const username = document.getElementById('login-username').value;
    const password = document.getElementById('login-password').value;
    const school = document.getElementById('login-school').value;
    
    // Egyszer≈± valid√°ci√≥ (val√≥s alkalmaz√°sban szerver oldali authentik√°ci√≥ kellene)
    const savedUser = localStorage.getItem(`user_${username}`);
    if (savedUser) {
        const userData = JSON.parse(savedUser);
        if (userData.password === password && userData.school === school) {
            currentUser = userData;
            localStorage.setItem('poolchat_user', JSON.stringify(currentUser));
            showMainMenu();
            updateUserInterface();
        } else {
            alert('Hib√°s bejelentkez√©si adatok!');
        }
    } else {
        alert('Felhaszn√°l√≥ nem tal√°lhat√≥!');
    }
}

function handleRegister(e) {
    e.preventDefault();
    
    const username = document.getElementById('reg-username').value;
    const password = document.getElementById('reg-password').value;
    const school = document.getElementById('reg-school').value;
    const age = document.getElementById('reg-age').value;
    const gender = document.getElementById('reg-gender').value;
    const om = document.getElementById('reg-om').value;
    
    // Ellen≈ërizz√ºk, hogy l√©tezik-e m√°r a felhaszn√°l√≥
    if (localStorage.getItem(`user_${username}`)) {
        alert('Ez a felhaszn√°l√≥n√©v m√°r foglalt!');
        return;
    }
    
    const userData = {
        username,
        password,
        school,
        age: parseInt(age),
        gender,
        om,
        registeredAt: new Date().toISOString()
    };
    
    // Mentj√ºk a felhaszn√°l√≥t
    localStorage.setItem(`user_${username}`, JSON.stringify(userData));
    
    currentUser = userData;
    localStorage.setItem('poolchat_user', JSON.stringify(currentUser));
    
    showMainMenu();
    updateUserInterface();
}

function logout() {
    currentUser = null;
    localStorage.removeItem('poolchat_user');
    showScreen('auth-screen');
    
    // Reset forms
    document.getElementById('login-form').reset();
    document.getElementById('register-form').reset();
}

// Navigation functions
function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
    });
    document.getElementById(screenId).classList.add('active');
}

function showMainMenu() {
    showScreen('main-screen');
}

function showSection(section) {
    showScreen(`${section}-screen`);
    
    if (section === 'profile') {
        updateProfileInfo();
    }
}

// Settings functions
function toggleSettings() {
    const panel = document.getElementById('settings-panel');
    panel.classList.toggle('active');
}

function closeSettings() {
    document.getElementById('settings-panel').classList.remove('active');
}

function setTheme(theme) {
    currentTheme = theme;
    document.body.setAttribute('data-theme', theme);
    localStorage.setItem('poolchat_theme', theme);
    
    // Update theme buttons
    document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    if (theme === 'light') {
        document.getElementById('light-mode').classList.add('active');
    } else {
        document.getElementById('dark-mode').classList.add('active');
    }
}

function updateUserInterface() {
    if (!currentUser) return;
    
    // Update settings panel
    document.getElementById('user-school').textContent = schoolNames[currentUser.school];
    document.getElementById('user-age').textContent = currentUser.age;
    document.getElementById('user-gender').textContent = genderNames[currentUser.gender];
    document.getElementById('user-posts').textContent = userStats.posts;
    document.getElementById('user-likes').textContent = userStats.likes;
}

function updateProfileInfo() {
    if (!currentUser) return;
    
    document.getElementById('profile-username').textContent = currentUser.username;
    document.getElementById('profile-school-info').textContent = 
        `${schoolNames[currentUser.school]} ‚Ä¢ ${currentUser.age} √©ves ‚Ä¢ ${genderNames[currentUser.gender]}`;
    document.getElementById('profile-posts').textContent = userStats.posts;
    document.getElementById('profile-likes').textContent = userStats.likes;
}

// Posts functions
function addPost() {
    const content = document.getElementById('new-post').value.trim();
    if (!content) {
        alert('K√©rlek √≠rj valamit!');
        return;
    }
    
    const post = {
        id: Date.now(),
        author: currentUser.username,
        content: content,
        timestamp: new Date().toISOString(),
        likes: 0,
        likedBy: []
    };
    
    posts.unshift(post);
    userStats.posts++;
    
    // Ment√©s
    localStorage.setItem('poolchat_posts', JSON.stringify(posts));
    localStorage.setItem('poolchat_stats', JSON.stringify(userStats));
    
    // UI friss√≠t√©s
    document.getElementById('new-post').value = '';
    renderPosts();
    updateUserInterface();
}

function renderPosts() {
    const container = document.getElementById('posts-container');
    
    // Megtartjuk a p√©lda bejegyz√©st, ha nincs m√°s
    if (posts.length === 0) {
        return;
    }
    
    container.innerHTML = '';
    
    posts.forEach(post => {
        const postElement = document.createElement('div');
        postElement.className = 'post';
        
        const timeAgo = getTimeAgo(new Date(post.timestamp));
        const isLiked = post.likedBy.includes(currentUser?.username);
        
        postElement.innerHTML = `
            <div class="post-header">
                <strong>${post.author}</strong>
                <span class="post-time">${timeAgo}</span>
            </div>
            <div class="post-content">
                ${post.content}
            </div>
            <div class="post-actions">
                <button class="like-btn ${isLiked ? 'liked' : ''}" onclick="toggleLike(this, ${post.id})">
                    <i class="${isLiked ? 'fas' : 'far'} fa-heart"></i>
                    <span class="like-count">${post.likes}</span>
                </button>
            </div>
        `;
        
        container.appendChild(postElement);
    });
}

function toggleLike(button, postId) {
    if (!currentUser) return;
    
    const post = posts.find(p => p.id === postId);
    if (!post) return;
    
    const userIndex = post.likedBy.indexOf(currentUser.username);
    
    if (userIndex === -1) {
        // Like
        post.likedBy.push(currentUser.username);
        post.likes++;
        button.classList.add('liked');
        button.querySelector('i').className = 'fas fa-heart';
        userStats.likes++;
    } else {
        // Unlike
        post.likedBy.splice(userIndex, 1);
        post.likes--;
        button.classList.remove('liked');
        button.querySelector('i').className = 'far fa-heart';
        userStats.likes--;
    }
    
    button.querySelector('.like-count').textContent = post.likes;
    
    // Ment√©s
    localStorage.setItem('poolchat_posts', JSON.stringify(posts));
    localStorage.setItem('poolchat_stats', JSON.stringify(userStats));
    updateUserInterface();
}

function getTimeAgo(date) {
    const now = new Date();
    const diffInMinutes = Math.floor((now - date) / (1000 * 60));
    
    if (diffInMinutes < 1) return 'most';
    if (diffInMinutes < 60) return `${diffInMinutes} perce`;
    
    const diffInHours = Math.floor(diffInMinutes / 60);
    if (diffInHours < 24) return `${diffInHours} √≥r√°ja`;
    
    const diffInDays = Math.floor(diffInHours / 24);
    return `${diffInDays} napja`;
}

// Chat functions
function startChat() {
    const button = document.getElementById('start-chat-btn');
    const btnText = button.querySelector('.btn-text');
    const spinner = button.querySelector('.loading-spinner');
    
    // Loading animation
    button.disabled = true;
    btnText.style.display = 'none';
    spinner.style.display = 'block';
    
    // Simulate finding a partner
    setTimeout(() => {
        // Generate random partner
        const schools = Object.keys(schoolNames);
        const genders = Object.keys(genderNames);
        
        chatPartner = {
            name: 'Anonymous',
            school: schools[Math.floor(Math.random() * schools.length)],
            age: Math.floor(Math.random() * 10) + 16, // 16-25 years
            gender: genders[Math.floor(Math.random() * genders.length)]
        };
        
        // Reset UI
        button.disabled = false;
        btnText.style.display = 'block';
        spinner.style.display = 'none';
        
        // Show chat window
        showChatWindow();
    }, 2000);
}

function showChatWindow() {
    document.getElementById('start-chat-btn').style.display = 'none';
    document.getElementById('chat-window').style.display = 'flex';
    
    // Update partner info
    document.getElementById('partner-name').textContent = chatPartner.name;
    document.getElementById('partner-school').textContent = schoolNames[chatPartner.school];
    document.getElementById('partner-age').textContent = chatPartner.age;
    document.getElementById('partner-gender').textContent = genderNames[chatPartner.gender];
    
    // Clear messages
    chatMessages = [];
    document.getElementById('messages-container').innerHTML = '';
    
    // Focus on input
    document.getElementById('message-input').focus();
    
    // Simulate partner messages
    setTimeout(() => {
        receiveMessage('Szia! üëã');
    }, 1000);
}

function sendMessage() {
    const input = document.getElementById('message-input');
    const message = input.value.trim();
    
    if (!message) return;
    
    // Add message to chat
    addMessageToChat(message, true);
    input.value = '';
    
    // Simulate partner response
    setTimeout(() => {
        const responses = [
            '√ârdekes! ü§î',
            'Igen, egyet√©rtek!',
            'Mes√©lj t√∂bbet err≈ël!',
            'Haha, vicces! üòÑ',
            'T√©nyleg? Nem tudtam!',
            'Szuper √∂tlet!',
            'Hmm, √©rtem...',
            'K√∂szi, hogy megosztottad!'
        ];
        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
        receiveMessage(randomResponse);
    }, Math.random() * 3000 + 1000);
}

function receiveMessage(message) {
    addMessageToChat(message, false);
}

function addMessageToChat(message, isOwn) {
    const container = document.getElementById('messages-container');
    const messageElement = document.createElement('div');
    messageElement.className = `message ${isOwn ? 'own' : ''}`;
    
    messageElement.innerHTML = `
        <div class="message-bubble">
            ${message}
        </div>
    `;
    
    container.appendChild(messageElement);
    container.scrollTop = container.scrollHeight;
    
    chatMessages.push({
        message,
        isOwn,
        timestamp: new Date().toISOString()
    });
}

function endChat() {
    document.getElementById('chat-window').style.display = 'none';
    document.getElementById('start-chat-btn').style.display = 'block';
    
    chatPartner = null;
    chatMessages = [];
}

// Initialize example posts if none exist
function initializeExamplePosts() {
    if (posts.length === 0) {
        posts.push({
            id: 1,
            author: 'Anonymous',
            content: '√öj tanul√°si m√≥dszer: gamifik√°lt programoz√°s oktat√°s VR k√∂rnyezetben!',
            timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(), // 2 hours ago
            likes: 5,
            likedBy: []
        });
        
        localStorage.setItem('poolchat_posts', JSON.stringify(posts));
    }
}

// Call this when the app initializes
setTimeout(initializeExamplePosts, 100);
</script>
</body>
</html>
